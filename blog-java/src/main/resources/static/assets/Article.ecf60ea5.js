import{_ as F,am as U,E as C,A as w,o as g,i as I,w as o,g as a,h as i,f as y,l as x,F as k,an as T,j as p,T as L,ao as S,ap as B,b as z,aq as N,e as j,r as K,k as A,t as v,p as M,n as P}from"./index.de08f477.js";import{a as X,b as O,E as W}from"./el-image-viewer.660ee909.js";import{E as J,a as G,b as Q}from"./el-select.8c19de9d.js";import"./el-tag.4a35146c.js";import{m as Y}from"./markdown.fab8dcaa.js";const Z={components:{},props:{tags:Array,categories:Array,editFlag:U},data(){return{imgChange:!1,newCategory:"",newTag:"",rules:{title:{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898",trigger:"blur"},category:{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",trigger:"blur"},tag:{required:!0,message:"\u8BF7\u9009\u62E9\u6807\u7B7E",trigger:"blur"}}}},methods:{test(){},dealImage(l){var e=new Image,s=.9;e.src=l,e.setAttribute("crossOrigin","Anonymous");var h,r;return new Promise(t=>{e.onload=async function(){h=this.width,r=this.height;var d=document.createElement("canvas"),u=d.getContext("2d");let f=1920;Math.max(h,r)>f?h>r?(d.width=f,d.height=f*r/h):(d.height=f,d.width=f*h/r):(d.width=h,d.height=r,s=1),u.clearRect(0,0,d.width,d.height),u.drawImage(this,0,0,d.width,d.height);for(var c=d.toDataURL("image/jpeg",s);c.length/1024>1e3;)s-=.05,c=d.toDataURL("image/jpeg",s);t(c)}})},uploadHandler(l){let e=new FileReader;e.readAsDataURL(l.file),e.onload=async s=>{this.article.img=await this.dealImage(s.target.result)},this.imgChange=!0},handleExceed(l){this.$refs.uploadRef.clearFiles(),this.$refs.uploadRef.handleStart(l[0]);let e=new FileReader;e.readAsDataURL(l[0]),e.onload=async s=>{this.article.img=await this.dealImage(s.target.result)}},addCategory(){console.log("add new category",this.newCategory),this.categories.push(this.newCategory),this.article.category=this.newCategory,this.newCategory=""},addTag(){console.log("add new tag",this.newTag),this.tags.push(this.newTag),this.article.tag.push(this.newTag),this.newTag=""},drapContent(l){let e=document.getElementsByClassName("input-body")[0],s=document.getElementsByClassName("markdown-body")[0],h=window.getComputedStyle(e).getPropertyValue("width"),r=window.getComputedStyle(s).getPropertyValue("width"),t=l.clientX;document.onmousemove=function(d){let u=d.clientX-t;h.slice(0,-2)>100&&r.slice(0,-2)>100&&(e.style.width=`calc(${h} + ${u}px)`,s.style.width=`calc(${r} - ${u}px)`)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},resetSize(){let l=document.getElementsByClassName("markdown")[0],e=document.getElementsByClassName("html")[0];l.style.width="50%",e.style.width="calc(50% - 20px)",document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},saveToScript(){},saveAndIssue(){this.$refs.articleRef.validate(l=>{if(l){if(this.article.img==""){C({showClose:!0,message:"\u8BF7\u9009\u62E9\u4E00\u5F20\u63D2\u56FE",type:"warning"});return}if(this.article.content==""){C({showClose:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",type:"warning"});return}if(this.editFlag){let e=this.article;this.imgChange||(e.img=""),console.log(e),w.post("article/update",e).then(s=>{s.code==200&&C({type:"success",message:"\u4FEE\u6539\u6210\u529F"})})}else w.post("article/add",this.article).then(e=>{e.code==200&&C({type:"success",message:"\u53D1\u8868\u6210\u529F"})});this.editDialog=!1}})},resetForm(){this.$refs.articleRef.resetFields()},closeAndSaveToScript(){this.editDialog=!1},closeHandler(){this.$refs.uploadRef.clearFiles(),setTimeout(()=>{this.resetForm()},100)}},computed:{htmlContent(){return Y(this.article.content)},editDialog:{get(){return this.$store.state.editDialog},set(l){this.$store.state.editDialog=l}},article(){return this.$store.state.article}},watch:{},mounted(){}},$={class:"header"},ee={class:"title"},te={class:"info"},ae={style:{margin:"0 15px"}},le={style:{margin:"0 15px"}},se={style:{height:"150px",width:"250px",translate:"0 -30px"}},oe={style:{margin:"10px 0"}},ie={style:{margin:"10px 0"}},ne={class:"content"},re={class:"input-body"},de=["innerHTML"];function ce(l,e,s,h,r,t){const d=S,u=B,f=J,c=G,_=X,m=z,V=Q,D=O,H=W,q=N,R=j;return g(),I(R,{style:{"border-radius":"10px","z-index":"2","margin-bottom":"100px"},modelValue:t.editDialog,"onUpdate:modelValue":e[8]||(e[8]=n=>t.editDialog=n),top:"60px",width:"90%","close-on-click-modal":!1,"close-on-press-escape":!1,onClose:t.closeHandler,"append-to-body":!0},{default:o(()=>[a(q,{id:"myform",model:t.article,ref:"articleRef",rules:r.rules},{default:o(()=>[i("div",$,[a(D,null,{default:o(()=>[a(_,{span:12},{default:o(()=>[i("div",ee,[a(u,{prop:"title"},{default:o(()=>[a(d,{style:{"font-size":"20px"},size:"large",modelValue:t.article.title,"onUpdate:modelValue":e[0]||(e[0]=n=>t.article.title=n),placeholder:"\u6807\u9898"},null,8,["modelValue"])]),_:1})]),i("div",te,[a(D,null,{default:o(()=>[a(_,{span:7},{default:o(()=>[a(u,{prop:"category"},{default:o(()=>[a(c,{modelValue:t.article.category,"onUpdate:modelValue":e[2]||(e[2]=n=>t.article.category=n),placeholder:"\u9009\u62E9\u5206\u7C7B"},{default:o(()=>[(g(!0),y(k,null,x(s.categories,(n,E)=>(g(),I(f,{key:E,label:n,value:n},null,8,["label","value"]))),128)),i("div",ae,[a(d,{modelValue:r.newCategory,"onUpdate:modelValue":e[1]||(e[1]=n=>r.newCategory=n),placeholder:"\u65B0\u5EFA\u5206\u7C7B",type:"text",onKeyup:T(t.addCategory,["enter"])},null,8,["modelValue","onKeyup"])])]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(_,{span:1}),a(_,{span:7},{default:o(()=>[a(u,{prop:"tag"},{default:o(()=>[a(c,{modelValue:t.article.tag,"onUpdate:modelValue":e[4]||(e[4]=n=>t.article.tag=n),placeholder:"\u9009\u62E9\u6807\u7B7E","collapse-tags":"",multiple:!0,clearable:""},{default:o(()=>[(g(!0),y(k,null,x(s.tags,(n,E)=>(g(),I(f,{key:E,label:n,value:n},null,8,["label","value"]))),128)),i("div",le,[a(d,{modelValue:r.newTag,"onUpdate:modelValue":e[3]||(e[3]=n=>r.newTag=n),placeholder:"\u65B0\u5EFA\u6807\u7B7E",type:"text",onKeyup:T(t.addTag,["enter"])},null,8,["modelValue","onKeyup"])])]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(_,{span:1}),a(_,{span:8},{default:o(()=>[a(V,{ref:"uploadRef",class:"upload-demo",name:"illustrate",accept:".png, .jpg","http-request":t.uploadHandler,limit:1,"on-exceed":t.handleExceed},{trigger:o(()=>[a(m,{type:"primary"},{default:o(()=>[p("\u9009\u62E9\u63D2\u56FE")]),_:1})]),_:1},8,["http-request","on-exceed"])]),_:1})]),_:1})])]),_:1}),a(_,{span:1}),a(_,{span:6},{default:o(()=>[a(L,{name:"el-zoom-in-top"},{default:o(()=>[i("div",se,[a(H,{class:"img",fit:"cover",src:t.article.img},null,8,["src"])])]),_:1})]),_:1}),a(_,{span:4},{default:o(()=>[i("div",null,[a(m,{type:"primary",onClick:t.saveToScript},{default:o(()=>[p("\u4FDD\u5B58\u5230\u8349\u7A3F")]),_:1},8,["onClick"])]),i("div",oe,[a(m,{type:"primary",onClick:t.saveAndIssue},{default:o(()=>[p("\u53D1\u8868")]),_:1},8,["onClick"])]),i("div",ie,[a(m,{type:"danger",onClick:t.closeAndSaveToScript},{default:o(()=>[p("\u5173\u95ED")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),i("div",ne,[i("div",re,[a(d,{style:{"font-size":"16px",height:"100%"},type:"textarea",modelValue:t.article.content,"onUpdate:modelValue":e[5]||(e[5]=n=>t.article.content=n),resize:"none",placeholder:"\u6587\u7AE0\u5185\u5BB9"},null,8,["modelValue"])]),i("div",{class:"resize",onMousedown:e[6]||(e[6]=(...n)=>t.drapContent&&t.drapContent(...n)),onDblclick:e[7]||(e[7]=(...n)=>t.resetSize&&t.resetSize(...n))},null,32),i("div",{class:"markdown-body",innerHTML:t.htmlContent},null,8,de)])]),_:1},8,["model","rules"]),a(m,{type:"primary",onClick:t.saveToScript},{default:o(()=>[p("\u4FDD\u5B58\u5230\u8349\u7A3F")]),_:1},8,["onClick"]),a(m,{type:"primary",onClick:t.saveAndIssue},{default:o(()=>[p("\u53D1\u8868")]),_:1},8,["onClick"]),a(m,{type:"danger",onClick:t.closeAndSaveToScript},{default:o(()=>[p("\u5173\u95ED")]),_:1},8,["onClick"])]),_:1},8,["modelValue","onClose"])}const ue=F(Z,[["render",ce],["__scopeId","data-v-bd2cf29c"]]);const ge={components:{ArticleEditorVue:ue},props:["authorId"],data(){return{editFlag:!1,query:"",articleList:[],queryData:{authorId:"",startPage:0,pageSize:10},categories:[],tags:[]}},methods:{queryHandler(){},addHandler(){this.$store.commit("clearArticle"),this.editDialog=!0,this.editFlag=!1},editHandler(l){let e={ArticleId:l};w.get("init/getArticle",e).then(s=>{s.code==200&&(s.data.img=this.baseUrl+s.data.img,this.$store.commit("setArticle",s.data),setTimeout(()=>{this.editFlag=!0,this.editDialog=!0},100))})},deleteHandler(l){},articleDeail(l){this.$router.push({path:"/ArticleDetail/"+l})}},computed:{editDialog:{get(){return this.$store.state.editDialog},set(l){this.$store.state.editDialog=l}},showFlag(){return!!(this.$store.state.isLogin&&this.authorId==this.$store.state.author.username)}},watch:{},mounted(){this.queryData.authorId=this.authorId,w.get("init/getArticles",this.queryData).then(e=>{e.data.forEach(s=>{s.tag=JSON.parse(s.tag).tags,s.digest=s.digest.replace(/#*.*#/g,"").replace(/[^a-z0-9\u4e00-\u9fa5]/,"").substring(0,200),this.articleList.push(s)})});let l={authorId:this.authorId};w.get("init/getTags",l).then(e=>{this.tags=e.data}),w.get("init/getCategories",l).then(e=>{this.categories=e.data})}},b=l=>(M("data-v-78ff4fd6"),l=l(),P(),l),me={class:"body"},pe={style:{display:"flex","justify-content":"space-between"}},he={style:{width:"200px",display:"inline-block",opacity:"0.5"}},_e={style:{"margin-left":"20px",display:"inline-block",opacity:"0.5"}},fe={key:0,style:{"margin-left":"20px",opacity:"0.7"}},ye=["data-index"],we={class:"content"},ve=["onClick"],Ce=b(()=>i("span",null," \u65F6\u95F4:",-1)),xe={style:{color:"#d63a3a","font-size":"90%"}},ke=b(()=>i("span",null," \u5206\u7C7B:",-1)),be={style:{color:"#d63a3a","font-size":"90%"}},Ve=b(()=>i("span",null," \u6807\u7B7E:",-1)),Ee=b(()=>i("span",{style:{color:"#00c6a5"}},null,-1)),Ie={style:{margin:"10px 0","text-indent":"2em","line-height":"20px"}},Ae={class:"but"},De={key:0,class:"buttom"},Te={key:1,class:"buttom"};function Fe(l,e,s,h,r,t){const d=S,u=z,f=K("ArticleEditorVue");return g(),y("div",me,[i("div",pe,[i("div",null,[i("div",he,[a(d,{modelValue:r.query,"onUpdate:modelValue":e[0]||(e[0]=c=>r.query=c)},null,8,["modelValue"])]),i("div",_e,[a(u,{color:"#626aef",onClick:t.queryHandler},{default:o(()=>[p("\u67E5\u627E")]),_:1},8,["onClick"])])]),t.showFlag?(g(),y("div",fe,[a(u,{color:"#ffae19",onClick:t.addHandler},{default:o(()=>[p("\u5199\u6587\u7AE0")]),_:1},8,["onClick"])])):A("",!0)]),(g(!0),y(k,null,x(r.articleList,(c,_)=>(g(),y("div",{key:c.id,"data-index":_,class:"article"},[i("div",we,[i("div",null,[i("span",{class:"title",onClick:m=>t.articleDeail(c.id)},v(c.title)+" \xA0",9,ve),Ce,i("span",xe,v(c.createTime)+" \xA0",1),ke,i("span",be,v(c.category)+" \xA0",1),Ve,(g(!0),y(k,null,x(c.tag,(m,V)=>(g(),y("span",{style:{color:"#d63a3a","font-size":"90%"},key:V},[p(v(m)+" ",1),Ee]))),128))]),i("div",Ie,v(c.digest),1)]),i("div",Ae,[t.showFlag?(g(),y("div",De,[a(u,{type:"primary",onClick:m=>t.editHandler(c.id)},{default:o(()=>[p("\u7F16\u8F91")]),_:2},1032,["onClick"])])):A("",!0),t.showFlag?(g(),y("div",Te,[a(u,{type:"danger",onClick:m=>t.deleteHandler(c.id)},{default:o(()=>[p("\u5220\u9664")]),_:2},1032,["onClick"])])):A("",!0)])],8,ye))),128)),a(f,{categories:r.categories,tags:r.tags,editFlag:r.editFlag},null,8,["categories","tags","editFlag"])])}const Ue=F(ge,[["render",Fe],["__scopeId","data-v-78ff4fd6"]]);export{Ue as default};
